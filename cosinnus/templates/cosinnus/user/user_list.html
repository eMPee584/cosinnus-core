{% extends "cosinnus/base.html" %}
{% load i18n thumbnail cosinnus_tags static %}

{% block page_title %}{% trans "Users" %}{% endblock %}

{% block extrahead %}
    {{ block.super }}
    <link href="{% static 'css/vendor/leaflet.css' %}" rel="stylesheet">
    <script src="{% static 'js/vendor/leaflet.js' %}"></script>
    <script src="{% static 'endless_pagination/js/endless-pagination.js' %}"></script>
    <script>$(function(){$.endlessPaginate({
					paginateOnScroll: true, 
					paginateOnScrollMargin: 250, 
					onCompleted: $.cosinnus.fadedown
				});
			});
	</script>
{% endblock extrahead %}

{% block leftnav %}
    {% include "cosinnus/group/leftnav_all_groups.html"  with current_page="userlist" %}
{% endblock leftnav %}


{% block breadcrumb %}
    <li><a href="{% url 'cosinnus:user-list' %}">{% trans "User overview" %}</a></li>
    <li class="active">{% trans "Overview" %}</li>
{% endblock %}

{% block content %}
    
    <!-- a box with semi transparent background -->
    <div class="content-box">
        
        <div id="map"></div>
        <script type="application/javascript">
            var mapData = [
                {% for user in object_list %}
	                {% with mt=user.cosinnus_profile.media_tag %}
	                    {% if mt and mt.location and mt.location_lat and mt.location_lon %}
	                        {
	                        	lat: {{ mt.location_lat|stringformat:"f" }}, 
	                         	lon: {{ mt.location_lon|stringformat:"f" }}, 
	                         	title: '<img src="{{ user.cosinnus_profile.get_map_marker_image_url }}" width="40px" class="pull-left"><div style="margin-left: 50px; min-height: 40px;"><a href="{% url 'cosinnus:profile-detail' username=user.username %}">{{ user|full_name }}</a><br/><span>{% block user_map_popup_details %}{{ mt.location }}{% endblock %}</span></div>',
	                         	{% if user.cosinnus_profile.get_map_marker_image_url %}
	                         		avatar: "{{ user.cosinnus_profile.get_map_marker_image_url }}",
	                         	{% endif %}
                 			},
	                    {% endif %}
	                {% endwith %}
		        {% endfor %}
            ];
        </script>
        {% include 'cosinnus/common/map_expand_button.html' %}
        <div class="clearfix"></div>
    </div>
    
    <!-- a box with semi transparent background -->
    <div class="content-box">
        
        <!-- hidden as long as create link is in the leftnav
        {% if user|is_superuser %}
	        <div type="button" class="btn btn-default w100 large-space">
                <ul class="media-list">
                    <li class="media">
                        <a class="pull-left" href="#">
                            <i class="fa fa-plus"></i>
                        </a>
                        <div class="media-body media-body-form-control">
                            <input class="form-control next-button-is-for-sending"
                                placeholder="Gib den Titel fÃ¼r eine neue Gruppe ein."
                                value="" />
                        </div>
                    </li>
                </ul>
            </div>
            <button type="button" class="btn btn-emphasized large-space" style="display: none;">
                <ul class="media-list">
                    <li class="media">
                        <a class="pull-left" href="#">
                            <i class="fa fa-pencil"></i>
                        </a>
                        <div class="media-body">
                            Erstellen
                        </div>
                    </li>
                </ul>
            </button>
        {% endif %}
        -->
        {% include 'cosinnus/user/user_list_items.html' %}
        
		{% if hidden_user_count > 0 %}
            <div class="btn btn-default w100">
                <ul class="media-list">
                    <li class="media">
                        <a class="pull-left" href="#">
                            <img src="{% static 'images/jane-doe.png' %}" />
                        </a>
                        <div class="media-body">
                            {% blocktrans with hidden_count=hidden_user_count %}And {{ hidden_count }} private users...{% endblocktrans %}
                        </div>
                    </li>
                </ul>
            </div>
		{% endif %}

    </div>
    
{% endblock %}

