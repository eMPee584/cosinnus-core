{% extends "cosinnus/base.html" %}
{% load i18n cosinnus_tags %}
{% load static from staticfiles %}

{% block page_title %}{{ group.name }} {{ block.super }}{% endblock page_title %}

{% block extrahead %}
  <link href="{% static "css/cosinnus.dashboard.css" %}" rel="stylesheet">
{% endblock extrahead %}

{% block body_attributes %}{% if not user.is_authenticated %}class="body-no-nav"{% endif %}{% endblock body_attributes %}

{% block cosinnus_navbar %}
	{% if user.is_authenticated %}
		{{ block.super }}
	{% endif %}
{% endblock cosinnus_navbar %}


{% block main_page_header %}
    <a name="microsite"></a>
    
	{% if user.is_authenticated %}
		{% comment %} Combobox dropdown and breadcrumb {% endcomment %}
	    <div class="row">
	        <!-- start with left navigation -->
	        <div class="col-lg-3 col-md-3"><!-- left column -->
	            {% if group %}
	                {% cosinnus_menu "cosinnus/appsmenu.html" %}
	            {% endif %}
	        </div><!-- left column -->
	        <!-- now the content -->
	        <div class="col-lg-9 col-md-9"><!-- right column -->
	            <ol class="breadcrumb">
	                {% include 'cosinnus/breadcrumb.html' %}
	                <li class="active">{% trans "Microsite" %}</li>
	            </ol>
	        </div><!-- right column -->
	    </div><!-- row -->
    {% endif %}
    
    {% include 'cosinnus/messages.html' %}
{% endblock main_page_header %}
            

{% block main_page %}
    
    {% if group.wallpaper %}
		<div>
			<img class="img-responsive" src="{{ group.static_wallpaper_url }}"></img>
		</div>
	{% else %}
		<div>
			<img class="img-responsive" src="https://placehold.it/1400x400"></img>
		</div>
	{% endif %}
	
	
    <div class="dashboard-header">
        <div class="dashboard-header-image">
            <a href="{% group_url 'cosinnus:group-detail' group=group %}">
                {% include "cosinnus/group/group_avatar_image.html" with group=group %}
            </a>
        </div>
        <div class="dashboard-header-text">
            <h2>{{ group.name }}</h2>
            <p>
            	{% if group.public %}
            		<i>{% if group.type == 0 %}{% trans "Public Project in Portal" %}{% else %}{% trans "Public Society in Portal" %}{% endif %}: </i>
            	{% else %}
            		<i>{% if group.type == 0 %}{% trans "Project in Portal" %}{% else %}{% trans "Society in Portal" %}{% endif %}: </i> 
            	{% endif %}
            	{% include 'cosinnus/portal/portal_link_icon.html' with portal=group.portal %}
            	<a href="{{ group.portal.get_domain }}">{{ group.portal.name }}</a>
            </p>
            
            {% with parent=group.get_parent_typed %}
                {% if parent %}
                    <p>
                    	{% trans "Society" %}: <a href="{{ parent.get_absolute_url }}">{{ parent.name }}</a>
                    	{% with siblings=group.get_siblings %}
                    		{% if siblings %}
                    			| {% trans "Other Projects" %}: 
                    			{% for sibling in siblings %}
                    				<a href="{{ sibling.get_absolute_url }}">{{ sibling.name }}</a>
                    				{% if not forloop.last %}, {% endif %}
                    			{% endfor %}
                    		{% endif %}
                    	{% endwith %}
                    </p>
                {% else %}
		            {% with children=group.get_children %}
		        		{% if children %}
		        			<p>
			        			{% trans "Projects" %}: 
			        			{% for child in children %}
			        				<a href="{{ child.get_absolute_url }}">{{ child.name }}</a>{% if not forloop.last %}, {% endif %}
			        			{% endfor %}
		        			</p>
		        		{% endif %}
		        	{% endwith %}
                {% endif %}
            {% endwith %}
        </div>
    </div>
    
    <div>
    	<p><b>{% trans "Description" %}</b></p>
        {% if group.description_long and group.description_long|length > 0 %}
            {{ group.description_long|safe }}
        {% else %}
            <p>({% trans "No Description set" %})</p>
        {% endif %}
    </div>
	<br/>
	
	<div>
    	<p><b>{% trans "Contact" %}</b></p>
        {% if group.contact_info and group.contact_info|length > 0 %}
            {{ group.contact_info|safe }}
        {% else %}
            <p>({% trans "No Contact info set" %})</p>
        {% endif %}
    </div>
	<br/>
	
	<div>
		{% include "cosinnus/media_tags_group_readonly.html" with object=group %}
	</div><br/>
	
    {% if group.website %}
		<div>
			<p><b>{% trans "Website" %}</b></p>
        	<p><a href="{{ group.website }}" target="_blank">{{ group.website }}</a></p>
	    </div>
		<br/>
    {% endif %}
    
    {% if group.media_tag_object.location %}
    	<div>
			<p><b>{% trans "Location" %}</b></p>
        	<p><i class="fa fa-fw fa-map-marker"></i> <a href="{{ group.media_tag_object.location_url }}" target="_blank">{{ group.media_tag_object.location }}</a></p>
	    </div>
		<br/>
	{% endif %}
    
    <div>
    	<p><b>{% trans "Collaborate?" %}</b></p>
    	<p>
	    	{% if not user.is_authenticated %}
	    		<button style="float: none;" href="{% url 'cosinnus:user-add' %}?next={{ group.get_absolute_url }}" type="button" class="btn btn-emphasized">
                    <ul class="media-list">
                        <li class="media">
                            <a class="pull-left" href="#">
                                <i class="fa fa-sign-in"></i>
                            </a>
                            <div class="media-body">
                                {% trans "Register now!" %}
                            </div>
                        </li>
                    </ul>
                </button>
	    	{% elif user.pk in group.members %}
	            {% trans "You are a member!" %}
	            <button style="float: none;" href="{{ group.get_absolute_url }}" type="button" class="btn btn-emphasized">
                    <ul class="media-list">
                        <li class="media">
                            <a class="pull-left" href="#">
                                <i class="fa fa-sign-in"></i>
                            </a>
                            <div class="media-body">
                                {% trans "Go to group" %}
                            </div>
                        </li>
                    </ul>
                </button>
	        {% elif user.pk in group.pendings %}
	        	{% trans "Your membership request is still pending..." %}
	            <button style="float: none;" type="button" class="btn btn-emphasized" data-toggle="modal" data-target="#join_withdraw_modal">
                    <ul class="media-list">
                        <li class="media">
                            <a class="pull-left" href="#">
                                <i class="fa fa-sign-out"></i>
                            </a>
                            <div class="media-body">
                                <span>{% trans "Withdraw" context "withdraw join group button first item" %}</span>
	                    {% trans "Request" context "withdraw join group button second item" %}
                            </div>
                        </li>
                    </ul>
                </button>
	            {% captureas label %}{% blocktrans with title=group.name %}Do you really want to withdraw your join request to group „{{ title }}“?{% endblocktrans %}{% endcaptureas %}
	            {% captureas title %}{% trans "Withdraw Join Request" %}{% endcaptureas %}
	            {% captureas action %}{% group_url 'cosinnus:group-user-withdraw' group=group %}{% endcaptureas %}
	            {% include "cosinnus/modal_box.html" with id="join_withdraw_modal" label=label title=title form_action=action %}
	        {% else %}
	            <button style="float: none;" type="button" class="btn btn-emphasized" data-toggle="modal" data-target="#join_withdraw_modal">
                    <ul class="media-list">
                        <li class="media">
                            <a class="pull-left" href="#">
                                <i class="fa fa-sign-in"></i>
                            </a>
                            <div class="media-body">
                                <span>{% trans "Join" context "join group button first item" %}</span>
	                    		{% trans "Now" context "join group button second item" %}
                            </div>
                        </li>
                    </ul>
                </button>
	            {% captureas label %}{% blocktrans with title=group.name %}Do you wish to request to join „{{ title }}“?{% endblocktrans %}{% endcaptureas %}
	            {% captureas title %}{% trans "Join" %}{% endcaptureas %}
	            {% captureas action %}{% group_url 'cosinnus:group-user-join' group=group %}{% endcaptureas %}
	            
	            {% include "cosinnus/modal_box.html" with id="join_withdraw_modal" label=label title=title form_action=action %}
	        {% endif %}
	    </p>
	    <p>
	    	{% if group.public %}
	    		{% if not user.is_authenticated or not user.pk in group.members %}
	    		
	    			{% trans "This is a public group:" %}
		    		<button style="float: none;" href="{{ group.get_absolute_url }}?browse=true" type="button" class="btn btn-emphasized">
	                    <ul class="media-list">
	                        <li class="media">
	                            <a class="pull-left" href="#">
	                                <i class="fa fa-sign-in"></i>
	                            </a>
	                            <div class="media-body">
	                                {% trans "Browse group" %}
	                            </div>
	                        </li>
	                    </ul>
	                </button>
	    		
	    		{% endif %}
	    	{% endif %}
	    </p>
    </div>

{% endblock main_page %}


{% block extrafooter %}
  {{ block.super }}
{% endblock %}