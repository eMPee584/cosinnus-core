{% extends "cosinnus/base.html" %}
{% load i18n cosinnus_tags %}
{% load static from staticfiles %}

{% block page_title %}{{ group.name }} {{ block.super }}{% endblock page_title %}

{% block extrahead %}
  <link href="{% static "css/cosinnus.dashboard.css" %}" rel="stylesheet">
{% endblock extrahead %}

{% block body_attributes %}{% if not user.is_authenticated %}class="body-no-nav"{% endif %}{% endblock body_attributes %}

{% block cosinnus_navbar %}
	{% if user.is_authenticated %}
		{{ block.super }}
	{% endif %}
{% endblock cosinnus_navbar %}


{% block main_page_header %}
    <a name="microsite"></a>
    
	{% if user.is_authenticated %}
		{% comment %} Combobox dropdown and breadcrumb {% endcomment %}
	    <div class="row">
	        <!-- start with left navigation -->
	        <div class="col-lg-3 col-md-3"><!-- left column -->
	            {% if group %}
	                {% cosinnus_menu "cosinnus/appsmenu.html" %}
	            {% endif %}
	        </div><!-- left column -->
	        <!-- now the content -->
	        <div class="col-lg-9 col-md-9"><!-- right column -->
	            <ol class="breadcrumb">
	                {% include 'cosinnus/breadcrumb.html' %}
	                <li class="active">{% trans "Microsite" %}</li>
	            </ol>
	        </div><!-- right column -->
	    </div><!-- row -->
    {% endif %}
    
    {% include 'cosinnus/messages.html' %}
{% endblock main_page_header %}
            

{% block main_page %}
    
    {% if group.wallpaper %}
		<div>
			<img class="img-responsive" src="{{ group.static_wallpaper_url }}"></img>
		</div>
	{% endif %}
	
	
    <div class="dashboard-header">
        <div class="dashboard-header-image">
            <a href="{% group_url 'cosinnus:group-detail' group=group %}">
                {% include "cosinnus/group/group_avatar_image.html" with group=group %}
            </a>
        </div>
        <div class="dashboard-header-text">
            <h2>{{ group.name }}</h2>
            {% with society=group.get_parent_typed %}
                {% if society %}
                    <p><i>{% trans "Society:" %} <a href="{{ society.get_absolute_url }}">{{ society.name }}</a></i></p>
                {% endif %}
            {% endwith %}
        </div>
    </div>
    
    <div>
        {% if group.description and group.description|length > 0 %}
            {{ group.description|safe }}
        {% else %}
            ({% trans "No Description set" %})
        {% endif %}
    </div>
    
    <div>
    	Join and stuff:
    	
    	{% if not user.is_authenticated %}
    		<a href="{% url 'login' %}?next={{ group.get_absolute_url }}" class="">{% trans "Register now!" %}</a>
    	{% elif user.pk in group.members or user in group.admins %}
            <a href="{{ group.get_absolute_url }}" class="">{% trans "Go to group" %}</a>
        {% elif user.pk in group.pendings %}
            <div class="dashboard-header-link app-etherpad" data-toggle="modal" data-target="#join_withdraw_modal">
                <a href="#">
                    <i class="fa fa-sign-out"></i>
                    <span>{% trans "Withdraw" context "withdraw join group button first item" %}</span>
                    {% trans "Request" context "withdraw join group button second item" %}
                </a>
            </div>
            <div class="dashboard-header-link app-main">
                <i class="fa fa-info-circle"></i>
                <span>{% trans "Join" context "join request pending group button first item" %}</span>
                {% trans "Requested" context "join request pending group button second item" %}
            </div>
            {% captureas label %}{% blocktrans with title=group.name %}Do you really want to withdraw your join request to group „{{ title }}“?{% endblocktrans %}{% endcaptureas %}
            {% captureas title %}{% trans "Withdraw Join Request" %}{% endcaptureas %}
            {% captureas action %}{% group_url 'cosinnus:group-user-withdraw' group=group %}{% endcaptureas %}
            {% include "cosinnus/modal_box.html" with id="join_withdraw_modal" label=label title=title form_action=action %}
        {% else %}
            <div class="dashboard-header-link app-main" data-toggle="modal" data-target="#join_withdraw_modal">
                <a href="#">
                    <i class="fa fa-sign-in"></i>
                    <span>{% trans "Join" context "join group button first item" %}</span>
                    {% trans "Now" context "join group button second item" %}
                </a>
            </div>
            {% captureas label %}{% blocktrans with title=group.name %}Do you wish to request to join „{{ title }}“?{% endblocktrans %}{% endcaptureas %}
            {% captureas title %}{% trans "Join" %}{% endcaptureas %}
            {% captureas action %}{% group_url 'cosinnus:group-user-join' group=group %}{% endcaptureas %}
            
            {% include "cosinnus/modal_box.html" with id="join_withdraw_modal" label=label title=title form_action=action %}
        {% endif %}
    </div>

{% endblock main_page %}


{% block extrafooter %}
  {{ block.super }}
{% endblock %}